#include "cdll.h"
#include <fstream>
#include <sstream>
#include <iostream>
#include <algorithm>
#include <cstdlib>

int main(int argc, char *argv[]){
    CDLL data;
    std::string tweetid;
    std::string time;
    std::string tweet;
    
    std::ifstream myfile;
    myfile.open(argv[1]);
    while(myfile.is_open()){
        std::getline(myfile, tweetid,'|');
        if(myfile.eof()){
            break;
        }
        std::getline(myfile, time,'|');
        std::getline(myfile,tweet,'|');
        //std::cout<< tweetid << time << tweet <<std::endl; 
        data.append(time.c_str(),tweet.c_str());
        }
        myfile.close();
    
    while(1){
        //set the current by calling on go_first which is the head
        data.go_first();
        //get users input
        std::string input;
        std::getline(std::cin, input);
        //if the user chooses: 
        if(input == "n"){
            data.go_next();
            data.print_current();
        }
        if(input == "p"){
            data.go_prev();
            data.print_current();
        }
        if(input == "f"){
            data.go_first();
            data.print_current();
        }
        if(input == "l"){
            data.go_last();
            data.print_current();
        }
        if(std::isdigit(input[0])){
            int n = stoi(input);
            data.skip(n);
            data.print_current();
        }
        std::string substr;
        if(input[0] == 's' && input[1] == ' '){
            for(unsigned int i = 2; input[i] != ' '; i++){
                if(i == input.length() - 1 || input[i + 1] == ' '){
                    substr = input.substr(2,i-1);
                    break;
                    
                }
            }
            data.search(substr.c_str());
            data.print_current();
        }
        
        if(input == "q"){
            break;
        }
    }
    return 0;
}